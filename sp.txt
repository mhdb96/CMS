
CREATE PROCEDURE dbo.spTerms_ValidByYearId

		@Yearid int

AS
BEGIN
Select dbo.Terms.id From dbo.Terms Where dbo.Terms.id not in (Select dbo.Terms.id From dbo.Terms join dbo.ActiveTerms on dbo.ActiveTerms.TermId = dbo.Terms.id  where dbo.ActiveTerms.Yearid = @Yearid)
END
GO
----------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spCourses_Valid
	@DepartmentId int,
	@ActiveTermId int
AS
BEGIN
	
	Select * From dbo.Courses Where dbo.Courses.id not in (Select a.CourseId From dbo.Assignments a where a.DepartmentId = @DepartmentId AND a.ActiveTermId = @ActiveTermId)

END
GO
----------------------------------------------------------------------------------------------

CREATE PROCEDURE dbo.spActiveTerms_Delete

@ActiveTermsId int

AS
BEGIN
	
	DELETE FROM dbo.ActiveTerms WHERE dbo.ActiveTerms.id = @ActiveTermsId;

END
GO
------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spDepartments_Delete

@DepartmentsId int

AS
BEGIN
	
	DELETE FROM dbo.DepartmentOutcomes WHERE dbo.DepartmentOutcomes.DepartmentId = @DepartmentsId;
	DELETE FROM dbo.Departments WHERE dbo.Departments.id = @DepartmentsId;

END
GO
------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spTeachers_Delete

@UsersId int

AS
BEGIN
	DELETE FROM dbo.Assignments WHERE dbo.Assignments.TeacherId = (Select dbo.Teachers.id From dbo.Teachers Where dbo.Teachers.UserId = @UsersId );
	DELETE FROM dbo.Teachers WHERE dbo.Teachers.UserId = @UsersId;
	DELETE FROM dbo.Users WHERE dbo.Users.id = @UsersId;

END
GO
-------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spCourses_Delete

@CoursesId int

AS
BEGIN
	DELETE FROM dbo.CourseOutcomes WHERE dbo.CourseOutcomes.CourseId = @CoursesId;
	DELETE FROM dbo.Courses WHERE dbo.Courses.id = @CoursesId;

END
GO

----------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spAssignments_Delete

@AssignmentsId int

AS
BEGIN
	DELETE FROM dbo.Assignments WHERE dbo.Assignments.id = @AssignmentsId
END
GO
------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spAssignments_HasExamByActiveTermId
	@ActiveTermId int
AS
BEGIN
	
	Select * From dbo.Exams e Where e.AssignmentId in (Select a.id From dbo.Assignments a Where a.ActiveTermId = @ActiveTermId)

END
GO
------------------------------------------------------------------------------------------

CREATE PROCEDURE dbo.spAssignments_HasExamByActiveTermId
	@ActiveTermId int
AS
BEGIN
	
	Select * From dbo.Exams e Where e.AssignmentId in (Select a.id From dbo.Assignments a Where a.ActiveTermId = @ActiveTermId)

END
GO

--------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.spAssignments_HasExamByTeacherId
	@TeacherId int
AS
BEGIN
	
	Select * From dbo.Exams e Where e.AssignmentId in (Select a.id From dbo.Assignments a Where a.TeacherId = @TeacherId)

END
GO
---------------------------------------------------------------------------------------------
Create PROCEDURE dbo.spDepartments_HasStudentByDepartmentId
	@DepartmentId int
AS
BEGIN
	
	Select * From dbo.Students s Where s.DepartmentId = @DepartmentId;

END
GO
-------------------------------------------------------------------------------------
Create PROCEDURE dbo.spCourses_HasAssignmentByCourseId
	@CourseId int
AS
BEGIN
	
	Select * From dbo.Assignments a Where a.CourseId= @CourseId;

END
GO
---------------------------------------------------------------------------------------
Create PROCEDURE dbo.spAssignemtns_HasExamByAssignmentId
	@AssignmentId int
AS
BEGIN
	
	Select * From dbo.Exams e Where e.AssignmentId= @AssignmentId;

END
GO
---------------------------------------------------------------------------------
TABLE GÖREVÝ SP'LERÝ
--------------------------------------------------------------------------------

CREATE PROCEDURE dbo.spStudentMarks_GetAll

AS
BEGIN

Select * From Students s join Results r on s.id=r.StudentId join Questions q on r.QuestionId=q.id;

END
GO

----------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.Exams_GetById

		@ExamId int

AS
BEGIN
	Select * From dbo.Exams e where e.id=@ExamId
END
GO

-------------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.ExamsGroups_GetByExamId

		@ExamId int

AS
BEGIN
	Select * From dbo.ExamGroups e where e.id=@ExamId
END
GO

------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.Questions_GetByExamGroupId

		@ExamGroupId int

AS
BEGIN
	Select * From dbo.Questions q where q.ExamGroupId=@ExamGroupId
END
GO
------------------------------------------------------------------------------------
CREATE PROCEDURE dbo.Students_GetByExamGroupId

		@ExamGroupId int

AS
BEGIN
	Select s.* From dbo.Students s join
	dbo.Results r on r.StudentId=s.id join
	dbo.Questions q on r.QuestionId = q.id join
	dbo.ExamGroups eg on q.ExamGroupId=eg.id where eg.id=@ExamGroupId
END
GO
----------------------------------------------------------------------------------------

CREATE PROCEDURE dbo.Results_GetByStudentIdAndQuestionId

		@StudentId int,
		@QuestionId int
AS
BEGIN
	Select * from dbo.Results r where r.QuestionId=@QuestionId and r.StudentId=@StudentId
END
GO